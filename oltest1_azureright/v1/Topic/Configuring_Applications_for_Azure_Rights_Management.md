---
description: na
keywords: na
title: Configuring Applications for Azure Rights Management
search: na
ms.date: na
ms.service: rights-management
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: ea09cbc5-b98b-444e-8b60-5bc3cb199c36
---
# Konfigurowanie aplikacji Azure Rights Management
> [!NOTE]
> Te informacje są dla administratorów IT i konsultantów, którzy wdrożyli Azure Rights Management. Jeśli szukasz pomocy i informacje na temat sposobu używania Rights Management dla określonej aplikacji lub sposobu otwarcia pliku, który jest chroniony prawami, użyj pomocy i wskazówki, który towarzyszy aplikacji.
> 
> Na przykład aplikacji pakietu Office, kliknij ikonę Pomoc i wprowadź wyszukiwane terminy, takich jak **Rights Management** lub **IRM**. Aby RMS sharing aplikacji dla systemu Windows, zobacz [Podręcznik użytkownika aplikacji udostępniania Rights Management](http://technet.microsoft.com/library/dn339006.aspx).

Po wdrożeniu Azure Rights Management (Azure RMS) dla organizacji umożliwia skonfigurowanie aplikacji i usług w celu obsługi Azure RMS następujące informacje. Należą do aplikacji pakietu Office, takich jak Word 2013 i Word 2010 i usług, takich jak Exchange Online (reguły transportu, zapobiegania utraty danych, czy nie do przodu i szyfrowania wiadomości) i programu SharePoint Online (chronionej bibliotek). Uzyskać informacje o sposobie tych aplikacji i usług pomocy technicznej Rights Management, zobacz [Jak aplikacje obsługują Azure Rights Management](../Topic/How_Applications_Support_Azure_Rights_Management.md).

> [!IMPORTANT]
> Dla informacji o obsługiwanych wersji i innych parametrów, zobacz [Wymagania dotyczące systemu Azure Rights Management](../Topic/Requirements_for_Azure_Rights_Management.md).

-   [Usługi Office 365: Konfiguracja dla klientów i usług online](../Topic/Configuring_Applications_for_Azure_Rights_Management.md#BKMK_O365)

    -   [Exchange Online: Konfiguracja usługi IRM](../Topic/Configuring_Applications_for_Azure_Rights_Management.md#BKMK_ExchangeOnline)

    -   [SharePoint Online i usługi OneDrive dla firm: Konfiguracja usługi IRM](#BKMK_SharePointOnline)

-   [2016 roku pakietu Office i pakietu Office 2013: Konfiguracja dla klientów](#BKMK_Office2013Configuration)

-   [Pakiet Office 2010: Konfiguracja dla klientów](../Topic/Configuring_Applications_for_Azure_Rights_Management.md#BKMK_Office2010Configuration)

-   [Rights Management aplikacji do udostępniania: Instalacja i konfiguracja dla klientów](../Topic/Configuring_Applications_for_Azure_Rights_Management.md#BKMK_SharingApp)

    -   [RMS sharing aplikacji dla systemu Windows: Instalacja i Konfiguracja](../Topic/Configuring_Applications_for_Azure_Rights_Management.md#BKMK_SharingAppforWindows)

    -   [RMS sharing aplikacji mobilnej platformy: Instalacja](../Topic/Configuring_Applications_for_Azure_Rights_Management.md#BKMK_SharingAppMovileDevices)

-   [Inne aplikacje, które obsługują interfejsy API usług RMS: Instalacja i Konfiguracja](../Topic/Configuring_Applications_for_Azure_Rights_Management.md#BKMK_RMSAPIs)

Serwerów lokalnych, takich jak Exchange Server i SharePoint Server, zobacz temat [Łącznik zarządzania Azure prawa wdrażania](../Topic/Deploying_the_Azure_Rights_Management_Connector.md).

> [!TIP]
> Przykłady wysokiego poziomu oraz zrzuty ekranu aplikacji skonfigurowana do używania usług RMS Azure można znaleźć [Azure RMS w akcji: Administratorzy i użytkownicy wyświetlanych](../Topic/What_is_Azure_Rights_Management_.md#BKMK_RMSpictures) sekcji z [Co to jest Azure Rights Management?](../Topic/What_is_Azure_Rights_Management_.md) tematu.

## <a name="BKMK_O365"></a>Usługi Office 365: Konfiguracja dla klientów i usług online
Ponieważ usługi Office 365 w sposób macierzysty obsługuje Azure RMS, Konfiguracja komputera klienta, nie jest wymagana do obsługi funkcji zarządzania prawami prawa informacje dla aplikacji, takich jak Word, Excel, PowerPoint, Outlook i aplikacji sieci Web programu Outlook. Wszyscy użytkownicy mają przeprowadzić jest logowanie do aplikacji pakietu Office z ich [!INCLUDE[o365_1](../Token/o365_1_md.md)] poświadczenia i ich można chronić pliki i wiadomości e-mail i korzystać z plików i wiadomości e-mail, które chronionych przez innych użytkowników.

Jednak firma Microsoft zaleca stanowią uzupełnienie te aplikacje za pomocą funkcji zarządzania prawami udostępnianie aplikacji, umożliwiający użytkownikom korzystania z urzędem dodatków. Aby uzyskać więcej informacji, zobacz [Rights Management aplikacji do udostępniania: Instalacja i konfiguracja dla klientów](../Topic/Configuring_Applications_for_Azure_Rights_Management.md#BKMK_SharingApp) w tym temacie.

### <a name="BKMK_ExchangeOnline"></a>Exchange Online: Konfiguracja usługi IRM
Aby skonfigurować Exchange Online, aby obsługiwać Azure RMS, należy skonfigurować usługi zarządzania prawami prawa informacji programu Exchange Online. W tym celu należy użyć programu Windows PowerShell (nie ma potrzeby instalowania osobnej modułu) i uruchom [polecenia programu PowerShell dla programu Exchange Online](https://technet.microsoft.com/library/jj200677.aspx).

> [!NOTE]
> Obecnie nie można skonfigurować programu Exchange Online, aby obsługiwać Azure RMS korzystania z kluczem zarządzane przez klienta dzierżawy (BYOK) dla Azure RMS zamiast domyślnej konfiguracji klucz dzierżawy zarządzanych przez firmę Microsoft. Aby uzyskać więcej informacji, zobacz [BYOK pricing and restrictions](../Topic/Planning_and_Implementing_Your_Azure_Rights_Management_Tenant_Key.md#BKMK_Pricing) w sekcji [Planowanie i wdrażanie swoim kluczem dzierżawcy zarządzania prawami Azure](../Topic/Planning_and_Implementing_Your_Azure_Rights_Management_Tenant_Key.md) tematu.
> 
> Jeśli próbujesz skonfigurować Exchange Online, korzystając z Azure RMS jest BYOK, polecenia do importowania z kluczem (krok 5, w poniższej procedurze) nie powiodło się z powodu błędu **[FailureCategory = FailedToGetTrustedPublishingDomainFromRmsOnlineException polecenia Cmdlet]**.

Następujące kroki zapewniają typowe zestaw poleceń, które należy uruchomić umożliwiające Exchange Online, aby używać Azure RMS:

1.  Jeśli to jest użycie programu Windows PowerShell dla programu Exchange Online na komputerze po raz pierwszy, należy skonfigurować programu Windows PowerShell umożliwiające uruchomienie skryptów podpisem. Uruchom sesję programu Windows PowerShell, używając **Uruchom jako administrator** opcji, a następnie wpisz:

    ```
    Set-ExecutionPolicy RemoteSigned
    ```

2.  W sesji środowiska Windows PowerShell należy zalogować się przy użyciu konta, które jest włączone dla dostępu zdalnego powłoki programu Exchange Online. Domyślnie wszystkich kont, które są tworzone w trybie Online programu Exchange są włączone dla dostępu zdalnego Shell, ale to może być wyłączone (i włączone) przy użyciu   [użytkownika zestawu &lt; tożsamości użytkownika &gt; - RemotePowerShellEnabled](https://technet.microsoft.com/library/jj984292%28v=exchg.160%29.aspx) polecenia.

    Aby się zarejestrować, należy wpisać:

    ```
    $Cred = Get-Credential
    ```
    W **żądania poświadczeń Windows PowerShell** okna dialogowego pozycję dostarczają usługi Office 365, nazwę użytkownika i hasło.

3.  Połączenia z usługą Exchange Online, wykonaj następujące dwa polecenia:

    ```
    $Session = New-PSSession -ConfigurationName Microsoft.Exchange -ConnectionUri https://ps.outlook.com/powershell/ -Credential $Cred -Authentication Basic –AllowRedirection
    ```

    ```
    Import-PSSession $Session
    ```

4.  Określ lokalizację klucza dzierżawy Azure RMS, zgodnie z Twoim regionie:

    Ameryka Północna (i subskrypcje Rząd):

    ```
    Set-IRMConfiguration -RMSOnlineKeySharingLocation "https://sp-rms.na.aadrm.com/TenantManagement/ServicePartner.svc"
    ```
    Gospodarczej:

    ```
    Set-IRMConfiguration -RMSOnlineKeySharingLocation "https://sp-rms.eu.aadrm.com/TenantManagement/ServicePartner.svc"
    ```
    Dla Azji:

    ```
    Set-IRMConfiguration -RMSOnlineKeySharingLocation "https://sp-rms.ap.aadrm.com/TenantManagement/ServicePartner.svc"
    ```
    Dla Azji:

    ```
    Set-IRMConfiguration -RMSOnlineKeySharingLocation "https://sp-rms.sa.aadrm.com/TenantManagement/ServicePartner.svc"
    ```

5.  Importuj dane konfiguracji z Azure RMS Exchange online, w formie zaufanej domeny publikacji (publikacji). Należą do nich klucz dzierżawy Azure RMS i szablony Azure RMS:

    ```
    Import-RMSTrustedPublishingDomain -RMSOnline -name "RMS Online"
    ```
    W tym poleceniu użyliśmy nazwa **RMS Online** dla podstawowa nazwa publikacji dla Azure RMS w Exchange Online. Po zaimportowaniu publikacji nosi **RMS Online - 1** Exchange online.

6.  Tak, aby IRM funkcje są dostępne dla Exchange Online, należy włączyć funkcję Azure RMS:

    ```
    Set-IRMConfiguration -InternalLicensingEnabled $true
    ```
    Po uruchomieniu tego polecenia, Rights Management jest włączany automatycznie klient programu Outlook, aplikacji sieci Web programu Outlook i Exchange ActiveSync.

7.  Opcjonalnie testowania, ta konfiguracja jest pomyślne przy użyciu następującego polecenia:

    ```
    Test-IRMConfiguration -Sender <user email address>
    ```
    Na przykład: **Test-IRMConfiguration -Sender  adams@contoso.com**

    To polecenie uruchamia serię kontroli obejmuje sprawdzanie połączenia z usługą, pobierania konfiguracji, pobierając identyfikatory URI, licencji oraz wszystkie szablony. W sesji środowiska Windows PowerShell pojawią się wyniki każdej i na końcu, jeśli wszystko przekazuje te sprawdzenia: **WYNIK OGÓLNY: PRZEKAŻ**

8.  Odłączanie sesji zdalnej programu PowerShell:

    ```
    Remove-PSSession $Session
    ```

Użytkownicy mogą teraz chronić wiadomości e-mail za pomocą Azure RMS. Na przykład w aplikacji sieci Web programu Outlook, zaznacz **Ustawienia uprawnień** z rozszerzonych menu (**...**) i wybierz **nie przesyłaj dalej** lub jeden z dostępnych szablonów, aby zastosować ochrony informacji do wiadomości e-mail i załączniki. Jednakże ponieważ aplikacji sieci Web programu Outlook przechowuje interfejsu użytkownika dla dnia, poczekaj dla tego przedziału czasu oczekiwania przed podjęciem próby wykonania stosowania ochrony informacji do wiadomości e-mail i po uruchomieniu następujących poleceń konfiguracji. Przed interfejsu użytkownika aktualizowany w celu odzwierciedlenia nowej konfiguracji, nie będzie mógł przeglądać wszystkie opcje z **Ustawienia uprawnień** menu.

> [!IMPORTANT]
> Jeśli tworzysz nowe [Szablony niestandardowe](https://technet.microsoft.com/library/dn642472.aspx) Azure RMS lub aktualizacji szablony, każde, należy uruchomić następujące polecenie Exchange Online programu PowerShell (Jeśli to konieczne, uruchom kroki 2 i 3 najpierw) do synchronizowania tych zmian Exchange Online: `Import-RMSTrustedPublishingDomain -Name "RMS Online - 1" -RefreshTemplates –RMSOnline`

Jako administratora programu Exchange, możesz teraz skonfigurować funkcje mające zastosowanie ochrony informacji automatycznie, takich jak [transportu reguły](https://technet.microsoft.com/library/dd302432.aspx), [zasady zapobiegania (DLP) utraty danych](https://technet.microsoft.com/library/jj150527%28v=exchg.150%29.aspx), i [chronione poczta głosowa](https://technet.microsoft.com/library/dn198211%28v=exchg.150%29.aspx) (Unified Messaging).

Aby uzyskać szczegółowe instrukcje do konfigurowania Exchange Online, aby włączyć funkcję IRM zajrzyj do dokumentacji w bibliotece programu Exchange. Na przykład:

-   [Połącz z programu Exchange Online, przy użyciu zdalnego programu PowerShell](https://technet.microsoft.com/library/jj984289%28v=exchg.160%29.aspx)

-   [Skonfiguruj IRM do użycia Azure Rights Management](https://technet.microsoft.com/library/dn151475%28v=exchg.150%29.aspx)

#### Szyfrowanie wiadomości usługi Office 365
Uruchom te same czynności opisane w sekcji poprzedniej, ale jeśli nie chcesz, szablony, które mają być wyświetlane przed krok 6, uruchom następujące polecenie, aby uniemożliwić IRM szablony dostępne w aplikacji sieci Web programu Outlook i klient programu Outlook: `Set-IRMConfiguration -ClientAccessServerEnabled $false`

Teraz wszystko jest gotowe do skonfigurowania [transportu reguły](https://technet.microsoft.com/library/dd302432.aspx) automatycznie modyfikowania zabezpieczeń wiadomości, gdy odbiorcy znajdują się spoza organizacji, a następnie wybierz **Zastosuj szyfrowania wiadomości Office 365** opcji.

Aby uzyskać więcej informacji dotyczących szyfrowania wiadomości, zobacz [szyfrowania w usłudze Office 365](https://technet.microsoft.com/library/dn569286.aspx) w bibliotece programu Exchange.

### <a name="BKMK_SharePointOnline"></a>SharePoint Online i usługi OneDrive dla firm: Konfiguracja usługi IRM
Aby skonfigurować Online programu SharePoint i usługi OneDrive dla firm, która obsługuje Azure RMS, zostanie włączone usługi zarządzania prawami prawa informacji dla programu SharePoint Online za pomocą Centrum administracyjne programu SharePoint. Następnie właściciele witryn można chronić IRM ich listy programu SharePoint i bibliotek dokumentów i użytkownicy mogą IRM ochrony ich usługi OneDrive dla biblioteki biznesowe, aby dokumenty, które są zapisane w i udostępniać innym osobom, są automatycznie chronionych usługami Azure RMS.

Aby włączyć usługi zarządzania prawami prawa informacji dla programu SharePoint Online, zobacz następujące instrukcje w witrynie sieci Web pakietu Office:

-   [Ustaw konto informacji zarządzania prawami dostępu w Centrum administracyjnym programu SharePoint](http://office.microsoft.com/office365-sharepoint-online-enterprise-help/set-up-information-rights-management-irm-insharepoint-online-HA102895193.aspx)

Ta konfiguracja jest wykonywane przez administratora usługi Office 365.

#### Konfigurowanie usługi IRM dla biblioteki i listy
Po włączeniu usługi IRM dla programu SharePoint Właściciele witryn można chronić IRM ich bibliotek dokumentów programu SharePoint i list. Aby uzyskać instrukcje Zobacz następujących w witrynie sieci Web pakietu Office:

-   [Zastosuj zarządzania prawami dostępu do listy lub biblioteki](http://office.microsoft.com/sharepoint-help/apply-information-rights-management-to-a-list-or-library-HA102891460.aspx)

Ta konfiguracja jest wykonywane przez administratora witryny programu SharePoint.

#### <a name="BKMK_OneDrive"></a>Trwa konfigurowanie usługi IRM dla usługi OneDrive dla firm
Po włączeniu usługi IRM dla programu SharePoint Online, następnie można skonfigurować usługi OneDrive użytkowników dla biblioteki dokumentów firmy do ochrony Rights Management.  Użytkownicy mogą skonfigurować to dla siebie za pomocą **Ustawienia** ikony w ich usługi OneDrive. Mimo że administratorzy nie można skonfigurować Rights Management usługi OneDrive użytkowników dla firm za pomocą Centrum administracyjne programu SharePoint, możesz to zrobić przy użyciu programu Windows PowerShell.

> [!NOTE]
> Aby uzyskać więcej informacji na temat konfigurowania usługi OneDrive dla firm, zobacz dokumentację programu Office,[skonfigurować usługi OneDrive dla firmy w usłudze Office 365](https://support.office.com/article/Set-up-OneDrive-for-Business-in-Office-365-3e21f8f0-e0a1-43be-aa3e-8c0236bf11bb).

##### Konfigurowanie dla użytkowników
Daj użytkownikom te instrukcje, aby ich usługi OneDrive można skonfigurować dla firm i IRM ochronę plików firmy.

1.  W przypadku usługi OneDrive, kliknij przycisk **Ustawienia** ikonę, aby otworzyć menu Ustawienia, a następnie kliknij przycisk **zawartość witryny**.

2.  Wskaźnik myszy na **dokumenty** sąsiadująco, została wybrana wielokropka (**...**), a następnie kliknij przycisk **ustawień.**

3.  Na **Ustawienia** odszukaj **uprawnienia i zarządzanie** kliknij przycisk **zarządzania prawami do informacji**.

4.  Na **Ustawienia zarządzania prawami do informacji** zaznacz opcję **ograniczenia uprawnień w tej bibliotece podczas pobierania** pole wyboru, określ własną nazwę i opis dla uprawnienia, a opcjonalnie kliknij **Pokaż opcje** skonfigurować opcjonalne konfiguracji, a następnie kliknij przycisk **OK**.

    Aby uzyskać więcej informacji na temat opcji konfiguracji, zobacz instrukcje w [zastosowania zarządzania prawami do informacji z listy lub biblioteki](https://support.office.com/article/Apply-Information-Rights-Management-to-a-list-or-library-3bdb5c4e-94fc-4741-b02f-4e7cc3c54aa1) z dokumentów pakietu Office.

Ponieważ ta konfiguracja polega na użytkowników, a nie administrator IRM ochrony ich usługi OneDrive dla biblioteki Business, zapoznanie użytkowników korzyści ochrony plików i jak to zrobić. Na przykład wyjaśniają, że gdy mają za pomocą usługi OneDrive dla firm tylko osób, do których one upoważnienia do niego dostęp z jakieś ograniczenia konfigurowanych przez siebie, nawet jeśli plik jest zmieniana i skopiować innym miejscu.

##### Konfiguracja dla administratorów
Chociaż IRM dla usługi OneDrive użytkowników dla firm nie można skonfigurować za pomocą Centrum administracyjne programu SharePoint, możesz to zrobić przy użyciu programu Windows PowerShell. Aby włączyć IRM dla tych bibliotek, wykonaj następujące kroki:

1.  Pobierz i zainstaluj [SharePoint Online zestaw SDK składników klienta](http://www.microsoft.com/en-us/download/details.aspx?id=42038).

2.  Pobierz i zainstaluj [SharePoint Online powłoki zarządzania](http://www.microsoft.com/en-us/download/details.aspx?id=35588).

3.  Skopiuj poniższy skrypt zawartość i nazwę pliku zestawu IRMOnOneDriveForBusiness.ps1 na tym komputerze.

    *&#42;&#42;Wykluczenie&#42;&#42;*: Ten przykładowy skrypt nie jest obsługiwany w dowolnym standardowym programem ani usługą Microsoft. Ten przykładowy skrypt jest dostarczane IS bez jakiejkolwiek gwarancji.

    ```
    # Requires Windows PowerShell version 3 <# Description: Configures IRM policy settings for OneDrive for Business and can also be used for SharePoint Online libraries and lists Script Installation Requirements: SharePoint Online Client Components SDK http://www.microsoft.com/en-us/download/details.aspx?id=42038 SharePoint Online Management Shell http://www.microsoft.com/en-us/download/details.aspx?id=35588 ====== #> # URL will be in the format https://<tenant-name>-admin.sharepoint.com $sharepointAdminCenterUrl = "https://contoso-admin.sharepoint.com" $tenantAdmin = "admin@contoso.com" $webUrls = @("https://contoso-my.sharepoint.com/personal/user1_contoso_com", "https://contoso-my.sharepoint.com/personal/user2_contoso_com", "https://contoso-my.sharepoint.com/personal/user3_contoso_com") <# As an alternative to specifying the URLs as an array, you can import them from a CSV file (no header, single value per row). Then, use: $webUrls = Get-Content -Path "File_path_and_name.csv" #> $listTitle = "Documents" function Load-SharePointOnlineClientComponentAssemblies { [cmdletbinding()] param() process { # assembly location: C:\Program Files\Common Files\microsoft shared\Web Server Extensions\16\ISAPI try { Write-Verbose "Loading Assembly: Microsoft.Office.Client.Policy, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.Office.Client.Policy, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.Office.Client.TranslationServices, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.Office.Client.TranslationServices, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.DocumentManagement, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.DocumentManagement, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.Publishing, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.Publishing, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.Runtime, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.Runtime, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.Search.Applications, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.Search.Applications, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.Search, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.Search, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.Taxonomy, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.Taxonomy, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.UserProfiles, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.UserProfiles, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null return $true } catch { if($_.Exception.Message -match "Could not load file or assembly") { Write-Error -Message "Unable to load the SharePoint Server 2013 Client Components.`nDownload Location: http://www.microsoft.com/en-us/download/details.aspx?id=42038" } else { Write-Error -Exception $_.Exception } return $false } } } function Load-SharePointOnlineModule { [cmdletbinding()] param() process { do { # Installation location: C:\Program Files\SharePoint Online Management Shell\Microsoft.Online.SharePoint.PowerShell $spoModule = Get-Module -Name Microsoft.Online.SharePoint.PowerShell -ErrorAction SilentlyContinue if(-not $spoModule) { try { Import-Module Microsoft.Online.SharePoint.PowerShell -DisableNameChecking return $true } catch { if($_.Exception.Message -match "Could not load file or assembly") { Write-Error -Message "Unable to load the SharePoint Online Management Shell.`nDownload Location: http://www.microsoft.com/en-us/download/details.aspx?id=35588" } else { Write-Error -Exception $_.Exception } return $false } } else { return $true } } while(-not $spoModule) } } function Set-IrmConfiguration { [cmdletbinding()] param( [parameter(Mandatory=$true)][Microsoft.SharePoint.Client.List]$List, [parameter(Mandatory=$true)][string]$PolicyTitle, [parameter(Mandatory=$true)][string]$PolicyDescription, [parameter(Mandatory=$false)][switch]$IrmReject, [parameter(Mandatory=$false)][DateTime]$ProtectionExpirationDate, [parameter(Mandatory=$false)][switch]$DisableDocumentBrowserView, [parameter(Mandatory=$false)][switch]$AllowPrint, [parameter(Mandatory=$false)][switch]$AllowScript, [parameter(Mandatory=$false)][switch]$AllowWriteCopy, [parameter(Mandatory=$false)][int]$DocumentAccessExpireDays, [parameter(Mandatory=$false)][int]$LicenseCacheExpireDays, [parameter(Mandatory=$false)][string]$GroupName ) process { Write-Verbose "Applying IRM Configuration on '$($List.Title)'" # reset the value to the default settings $list.InformationRightsManagementSettings.Reset() $list.IrmEnabled = $true # IRM Policy title and description $list.InformationRightsManagementSettings.PolicyTitle       = $PolicyTitle $list.InformationRightsManagementSettings.PolicyDescription = $PolicyDescription # Set additional IRM library settings # Do not allow users to upload documents that do not support IRM $list.IrmReject = $IrmReject.IsPresent $parsedDate = Get-Date if([DateTime]::TryParse($ProtectionExpirationDate, [ref]$parsedDate)) { # Stop restricting access to the library at <date> $list.IrmExpire = $true $list.InformationRightsManagementSettings.DocumentLibraryProtectionExpireDate = $ProtectionExpirationDate } # Prevent opening documents in the browser for this Document Library $list.InformationRightsManagementSettings.DisableDocumentBrowserView = $DisableDocumentBrowserView.IsPresent # Configure document access rights # Allow viewers to print $list.InformationRightsManagementSettings.AllowPrint = $AllowPrint.IsPresent # Allow viewers to run script and screen reader to function on downloaded documents $list.InformationRightsManagementSettings.AllowScript = $AllowScript.IsPresent # Allow viewers to write on a copy of the downloaded document $list.InformationRightsManagementSettings.AllowWriteCopy = $AllowWriteCopy.IsPresent if($DocumentAccessExpireDays) { # After download, document access rights will expire after these number of days (1-365) $list.InformationRightsManagementSettings.EnableDocumentAccessExpire = $true $list.InformationRightsManagementSettings.DocumentAccessExpireDays   = $DocumentAccessExpireDays } # Set group protection and credentials interval if($LicenseCacheExpireDays) { # Users must verify their credentials using this interval (days) $list.InformationRightsManagementSettings.EnableLicenseCacheExpire = $true $list.InformationRightsManagementSettings.LicenseCacheExpireDays   = $LicenseCacheExpireDays } if($GroupName) { # Allow group protection. Default group: $list.InformationRightsManagementSettings.EnableGroupProtection = $true $list.InformationRightsManagementSettings.GroupName             = $GroupName } } end { if($list) { Write-Verbose "Committing IRM configuration settings on '$($list.Title)'" $list.InformationRightsManagementSettings.Update() $list.Update() $script:clientContext.Load($list) $script:clientContext.ExecuteQuery() } } } function Get-CredentialFromCredentialCache { [cmdletbinding()] param([string]$CredentialName) #if( Test-Path variable:\global:CredentialCache ) if( Get-Variable O365TenantAdminCredentialCache -Scope Global -ErrorAction SilentlyContinue ) { if($global:O365TenantAdminCredentialCache.ContainsKey($CredentialName)) { Write-Verbose "Credential Cache Hit: $CredentialName" return $global:O365TenantAdminCredentialCache[$CredentialName] } } Write-Verbose "Credential Cache Miss: $CredentialName" return $null } function Add-CredentialToCredentialCache { [cmdletbinding()] param([System.Management.Automation.PSCredential]$Credential) if(-not (Get-Variable CredentialCache -Scope Global -ErrorAction SilentlyContinue)) { Write-Verbose "Initializing the Credential Cache" $global:O365TenantAdminCredentialCache = @{} } Write-Verbose "Adding Credential to the Credential Cache" $global:O365TenantAdminCredentialCache[$Credential.UserName] = $Credential } # load the required assemblies and Windows PowerShell modules if(-not ((Load-SharePointOnlineClientComponentAssemblies) -and (Load-SharePointOnlineModule)) ) { return } # Add the credentials to the client context and SharePoint Online service connection # check for cached credentials to use $o365TenantAdminCredential = Get-CredentialFromCredentialCache -CredentialName $tenantAdmin if(-not $o365TenantAdminCredential) { # when credentials are not cached, prompt for the tenant admin credentials $o365TenantAdminCredential = Get-Credential -UserName $tenantAdmin -Message "Enter the password for the Office 365 admin" if(-not $o365TenantAdminCredential -or -not $o365TenantAdminCredential.UserName -or $o365TenantAdminCredential.Password.Length -eq 0 ) { Write-Error -Message "Could not validate the supplied tenant admin credentials" return } # add the credentials to the cache Add-CredentialToCredentialCache -Credential $o365TenantAdminCredential } # connect to Office365 first, required for SharePoint Online cmdlets to run Connect-SPOService -Url $sharepointAdminCenterUrl -Credential $o365TenantAdminCredential # enumerate each of the specified site URLs foreach($webUrl in $webUrls) { $grantedSiteCollectionAdmin = $false try { # establish the client context and set the credentials to connect to the site $script:clientContext = New-Object Microsoft.SharePoint.Client.ClientContext($webUrl) $script:clientContext.Credentials = New-Object Microsoft.SharePoint.Client.SharePointOnlineCredentials($o365TenantAdminCredential.UserName, $o365TenantAdminCredential.Password) # initialize the site and web context $script:clientContext.Load($script:clientContext.Site) $script:clientContext.Load($script:clientContext.Web) $script:clientContext.ExecuteQuery() # load and ensure the tenant admin user account if present on the target SharePoint site $tenantAdminUser = $script:clientContext.Web.EnsureUser($o365TenantAdminCredential.UserName) $script:clientContext.Load($tenantAdminUser) $script:clientContext.ExecuteQuery() # check if the tenant admin is a site admin if( -not $tenantAdminUser.IsSiteAdmin ) { try { # grant the tenant admin temporary admin rights to the site collection Set-SPOUser -Site $script:clientContext.Site.Url -LoginName $o365TenantAdminCredential.UserName -IsSiteCollectionAdmin $true | Out-Null $grantedSiteCollectionAdmin = $true } catch { Write-Error $_.Exception return } } try { # load the list orlibrary using CSOM $list = $null $list = $script:clientContext.Web.Lists.GetByTitle($listTitle) $script:clientContext.Load($list) $script:clientContext.ExecuteQuery() # **************  ADMIN INSTRUCTIONS  ************** # If necessary, modify the following Set-IrmConfiguration parameters to match your required values # The supplied options and values are for example only # Example that shows the Set-IrmConfiguration command with all parameters: Set-IrmConfiguration -List $list -PolicyTitle "Protected Files" -PolicyDescription "This policy restricts access to authorized users" -IrmReject -ProtectionExpirationDate $(Get-Date).AddDays(180) -DisableDocumentBrowserView -AllowPrint -AllowScript -AllowWriteCopy -LicenseCacheExpireDays 25 -DocumentAccessExpireDays 90 Set-IrmConfiguration -List $list -PolicyTitle "Protected Files" -PolicyDescription "This policy restricts access to authorized users" } catch { Write-Error -Message "Error setting IRM configuration on site: $webUrl.`nError Details: $($_.Exception.ToString())" } } finally { if($grantedSiteCollectionAdmin) { # remove the temporary admin rights to the site collection Set-SPOUser -Site $script:clientContext.Site.Url -LoginName $o365TenantAdminCredential.UserName -IsSiteCollectionAdmin $false | Out-Null } } } Disconnect-SPOService -ErrorAction SilentlyContinue
    ```

4.  Przejrzyj skrypt i dokonać następujących zmian:

    1.  Wyszukaj `$sharepointAdminCenterUrl` i zastąp wartość przykładowa własny adres URL centrum Administrator programu SharePoint.

        Można znaleźć tej wartości jako podstawowy adres URL po przejdź do Centrum administracyjne programu SharePoint i ma następujący format: https://*&lt; tenant_name &gt;*-admin.sharepoint.com

        Na przykład jeśli nazwa dzierżawy jest "contoso", następnie należy określić: **https://contoso-admin.sharepoint.com**

    2.  Wyszukaj `$tenantAdmin` i zastąpić Przykładowa wartość konta w pełni kwalifikowaną administratora globalnego dla usługi Office 365.

        Ta wartość jest taki sam, jak używać do logowania do portalu administratora usługi Office 365 jako administratora globalnego i ma następujący format: nazwa_użytkownika @*&lt; nazwa domeny dzierżawy &gt;*.com

        Na przykład jeśli nazwa użytkownika administratora globalnego usługi Office 365 "Administrator", "contoso.com" domeny dzierżawy, należy określić: **admin@contoso.com**

    3.  Wyszukaj `$webUrls` i Zastąp przykładowe wartości za pomocą usługi OneDrive użytkowników dla adresu URL sieci web firmy, dodawanie lub usuwanie dowolną liczbę wpisów, ile potrzebujesz.

        Możesz też wyświetlić komentarze w skrypcie sposobu importowania należy zastąpić ten tablicy. Plik CSV zawierający wszystkie adresy URL należy skonfigurować.  Przygotowaliśmy innego przykładowy skrypt, aby automatycznie wyszukać i Wyodrębnij narzędzie adresów URL do wypełnienia to. Plik CSV. Gdy wszystko jest gotowe to zrobić, rozwiń węzeł [Dodatkowe skryptu do wyjścia wszystkie usługi OneDrive dla adresu URL firmy do. Plik CSV](#BKMK_Script_OD4B_URLS) sekcji natychmiast po wykonaniu tych kroków.

        Sieci web jest adres URL usługi OneDrive użytkownika dla firm, w następującym formacie: https://*&lt; nazwa dzierżawy &gt;*-my.sharepoint.com/personal/*&lt; nazwa_użytkownika &gt;*_*&lt; nazwa dzierżawy &gt;*_com

        Na przykład jeśli użytkownik w dzierżawie contoso ma nazwę użytkownika "rsimone", należy określić: **https://contoso-my.sharepoint.com/personal/rsimone_contoso_com**

    4.  Ponieważ użyto skryptu można skonfigurować usługi OneDrive dla firm, nie zmieniaj wartość **Documents** dla `$listTitle` zmiennej.

    5.  Wyszukaj `ADMIN INSTRUCTIONS`. Jeśli użytkownik nie wprowadzisz zmian w tej sekcji, usługi OneDrive użytkownika dla firmy zostaną skonfigurowane dla IRM tytuł zasad "Chronionych plików" oraz "niniejszych zasad ogranicza dostęp do użytkowników autoryzowanych" opis.  Inne opcje IRM zostanie ustawiona, który jest prawdopodobnie odpowiedni dla większości środowisk. Można jednak zmienić zasady Sugerowany tytuł i opis, a także dodać inne opcje IRM, które są odpowiednie dla danego środowiska. Zobacz przykład komentarze w skrypcie pomaga utworzyć własny zestaw parametrów dla polecenia Set-IrmConfiguration.

5.  Zapisz skrypt i zarejestrować go. Jeśli nie rejestrować skryptu (bardziej bezpieczny), Windows PowerShell musi być skonfigurowany na komputerze, aby uruchamiać skrypty bez znaku. W tym celu należy uruchomić sesji środowiska Windows PowerShell z **Uruchom jako Administrator** i wprowadź: **Set-ExecutionPolicy Unrestricted**. Jednak ta konfiguracja umożliwia wszystkich niepodpisanych skrypty uruchamiania (mniej bezpieczne).

    Aby uzyskać więcej informacji na temat podpisywania skryptów programu Windows PowerShell, zobacz [about_Signing](https://technet.microsoft.com/library/hh847874.aspx) w bibliotece dokumentacji programu PowerShell.

6.  Uruchom skrypt, a jeśli zostanie wyświetlony monit, należy podać hasło dla konta administratora usługi Office 365. Jeśli zmodyfikuj skrypt i uruchom go w tej samej sesji środowiska Windows PowerShell, nie będzie monit o poświadczenia.

> [!TIP]
> Ten skrypt umożliwia także skonfigurować IRM w bibliotece Online programu SharePoint. W tej konfiguracji będzie prawdopodobnie ma zostać włączony dodatkowa opcja **Nie zezwalaj użytkownikom na przekazywanie dokumentów, które nie obsługują IRM**, aby upewnić się, że w bibliotece tylko do dokumentów chronionych.    Aby to zrobić, należy dodać `-IrmReject` do polecenia Set-IrmConfiguration w skrypcie.
> 
> Należy zmodyfikować `$webUrls` zmiennej (na przykład **https://contoso.sharepoint.com**) i  `$listTitle` zmiennej (na przykład **$Reports**).

Jeśli zachodzi potrzeba wyłączenia IRM dla usługi OneDrive użytkownika dla biblioteki Business, rozwiń [Skrypt w celu wyłączenia IRM dla usługi OneDrive dla firm](#BKMK_Script_OD4B_DisableIRM) sekcji.

###### <a name="BKMK_Script_OD4B_URLS"></a>Dodatkowe skryptu do wyjścia wszystkie usługi OneDrive dla adresu URL firmy do. Plik CSV
Krok 4c powyżej można użyć następujący skrypt programu Windows PowerShell wyodrębnić adresów URL dla usługi OneDrive wszystkich użytkowników dla biblioteki firmy, które należy sprawdzić następnie, w razie potrzeby zmodyfikuj, a następnie zaimportować do głównego skryptu.

Ten skrypt wymaga także [SharePoint Online zestaw SDK składników klienta](http://www.microsoft.com/en-us/download/details.aspx?id=42038) i [SharePoint Online powłoki zarządzania](http://www.microsoft.com/en-us/download/details.aspx?id=35588). Postępuj zgodnie z instrukcjami tej samej, aby skopiować i wkleić go, Zapisz plik lokalnie (na przykład "raport-OneDriveForBusinessSiteInfo.ps1"), modyfikowanie   `$sharepointAdminCenterUrl` i `$tenantAdmin` wartości jako przed, a następnie uruchom skrypt.

*&#42;&#42;Wykluczenie&#42;&#42;*: Ten przykładowy skrypt nie jest obsługiwany w dowolnym standardowym programem ani usługą Microsoft. Ten przykładowy skrypt jest dostarczane IS bez jakiejkolwiek gwarancji.

```
# Requires Windows PowerShell version 3 <# Description: Queries the search service of an Office 365 tenant to retrieve all OneDrive for Business sites. Details of the discovered sites are written to a .CSV file (by default,"OneDriveForBusinessSiteInfo_<date>.csv"). Script Installation Requirements: SharePoint Online Client Components SDK http://www.microsoft.com/en-us/download/details.aspx?id=42038 SharePoint Online Management Shell http://www.microsoft.com/en-us/download/details.aspx?id=35588 ====== #> # URL will be in the format https://<tenant-name>-admin.sharepoint.com $sharepointAdminCenterUrl = "https://contoso-admin.sharepoint.com" $tenantAdmin = "admin@contoso.onmicrosoft.com" $reportName = "OneDriveForBusinessSiteInfo_$((Get-Date).ToString("yyyy-MM-dd_hh.mm.ss")).csv" $oneDriveForBusinessSiteUrls= @() $resultsProcessed = 0 function Load-SharePointOnlineClientComponentAssemblies { [cmdletbinding()] param() process { # assembly location: C:\Program Files\Common Files\microsoft shared\Web Server Extensions\16\ISAPI try { Write-Verbose "Loading Assembly: Microsoft.Office.Client.Policy, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.Office.Client.Policy, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.Office.Client.TranslationServices, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.Office.Client.TranslationServices, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.DocumentManagement, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.DocumentManagement, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.Publishing, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.Publishing, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.Runtime, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.Runtime, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.Search.Applications, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.Search.Applications, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.Search, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.Search, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.Taxonomy, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.Taxonomy, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.UserProfiles, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.UserProfiles, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null return $true } catch { if($_.Exception.Message -match "Could not load file or assembly") { Write-Error -Message "Unable to load the SharePoint Server 2013 Client Components.`nDownload Location: http://www.microsoft.com/en-us/download/details.aspx?id=42038" } else { Write-Error -Exception $_.Exception } return $false } } } function Load-SharePointOnlineModule { [cmdletbinding()] param() process { do { # Installation location: C:\Program Files\SharePoint Online Management Shell\Microsoft.Online.SharePoint.PowerShell $spoModule = Get-Module -Name Microsoft.Online.SharePoint.PowerShell -ErrorAction SilentlyContinue if(-not $spoModule) { try { Import-Module Microsoft.Online.SharePoint.PowerShell -DisableNameChecking return $true } catch { if($_.Exception.Message -match "Could not load file or assembly") { Write-Error -Message "Unable to load the SharePoint Online Management Shell.`nDownload Location: http://www.microsoft.com/en-us/download/details.aspx?id=35588" } else { Write-Error -Exception $_.Exception } return $false } } else { return $true } } while(-not $spoModule) } } function Get-CredentialFromCredentialCache { [cmdletbinding()] param([string]$CredentialName) #if( Test-Path variable:\global:CredentialCache ) if( Get-Variable O365TenantAdminCredentialCache -Scope Global -ErrorAction SilentlyContinue ) { if($global:O365TenantAdminCredentialCache.ContainsKey($CredentialName)) { Write-Verbose "Credential Cache Hit: $CredentialName" return $global:O365TenantAdminCredentialCache[$CredentialName] } } Write-Verbose "Credential Cache Miss: $CredentialName" return $null } function Add-CredentialToCredentialCache { [cmdletbinding()] param([System.Management.Automation.PSCredential]$Credential) if(-not (Get-Variable CredentialCache -Scope Global -ErrorAction SilentlyContinue)) { Write-Verbose "Initializing the Credential Cache" $global:O365TenantAdminCredentialCache = @{} } Write-Verbose "Adding Credential to the Credential Cache" $global:O365TenantAdminCredentialCache[$Credential.UserName] = $Credential } # load the required assemblies and Windows PowerShell modules if(-not ((Load-SharePointOnlineClientComponentAssemblies) -and (Load-SharePointOnlineModule)) ) { return } # Add the credentials to the client context and SharePoint Online service connection # check for cached credentials to use $o365TenantAdminCredential = Get-CredentialFromCredentialCache -CredentialName $tenantAdmin if(-not $o365TenantAdminCredential) { # when credentials are not cached, prompt for the tenant admin credentials $o365TenantAdminCredential = Get-Credential -UserName $tenantAdmin -Message "Enter the password for the Office 365 admin" if(-not $o365TenantAdminCredential -or -not $o365TenantAdminCredential.UserName -or $o365TenantAdminCredential.Password.Length -eq 0 ) { Write-Error -Message "Could not validate the supplied tenant admin credentials" return } # add the credentials to the cache Add-CredentialToCredentialCache -Credential $o365TenantAdminCredential } # establish the client context and set the credentials to connect to the site $clientContext = New-Object Microsoft.SharePoint.Client.ClientContext($sharepointAdminCenterUrl) $clientContext.Credentials = New-Object Microsoft.SharePoint.Client.SharePointOnlineCredentials($o365TenantAdminCredential.UserName, $o365TenantAdminCredential.Password) # run a query against the Office 365 tenant search service to retrieve all OneDrive for Business URLs do { # build the query object $query = New-Object Microsoft.SharePoint.Client.Search.Query.KeywordQuery($clientContext) $query.TrimDuplicates        = $false $query.RowLimit              = 500 $query.QueryText             = "SPSiteUrl:'/personal/' AND contentclass:STS_Site" $query.StartRow              = $resultsProcessed $query.TotalRowsExactMinimum = 500000 # run the query $searchExecutor = New-Object Microsoft.SharePoint.Client.Search.Query.SearchExecutor($clientContext) $queryResults = $searchExecutor.ExecuteQuery($query) $clientContext.ExecuteQuery() # enumerate the search results and store the site URLs $queryResults.Value[0].ResultRows | % { $oneDriveForBusinessSiteUrls += $_.Path $resultsProcessed++ } } while($resultsProcessed -lt $queryResults.Value.TotalRows) $oneDriveForBusinessSiteUrls | Out-File -FilePath $reportName
```

###### <a name="BKMK_Script_OD4B_DisableIRM"></a>Skrypt w celu wyłączenia IRM dla usługi OneDrive dla firm
Jeśli zachodzi potrzeba wyłączenia IRM dla usługi OneDrive użytkowników dla firm, należy użyć następującego przykładowego skryptu.

Ten skrypt wymaga także [SharePoint Online zestaw SDK składników klienta](http://www.microsoft.com/en-us/download/details.aspx?id=42038) i [SharePoint Online powłoki zarządzania](http://www.microsoft.com/en-us/download/details.aspx?id=35588). Skopiuj i Wklej zawartość, Zapisz plik lokalnie (na przykład "Disable-IRMOnOneDriveForBusiness.ps1") i modyfikowania   `$sharepointAdminCenterUrl` i `$tenantAdmin` wartości. Ręcznie Określ usługi OneDrive dla adresu URL firmy lub skryptu w poprzedniej sekcji tak, aby zaimportować te, a następnie uruchom skrypt.

*&#42;&#42;Wykluczenie&#42;&#42;*: Ten przykładowy skrypt nie jest obsługiwany w dowolnym standardowym programem ani usługą Microsoft. Ten przykładowy skrypt jest dostarczane IS bez jakiejkolwiek gwarancji.

```
# Requires Windows PowerShell version 3 <# Description: Disables IRM for OneDrive for Business and can also be used for SharePoint Online libraries and lists Script Installation Requirements: SharePoint Online Client Components SDK http://www.microsoft.com/en-us/download/details.aspx?id=42038 SharePoint Online Management Shell http://www.microsoft.com/en-us/download/details.aspx?id=35588 ====== #> $sharepointAdminCenterUrl = "https://contoso-admin.sharepoint.com" $tenantAdmin = "admin@contoso.com" $webUrls = @("https://contoso-my.sharepoint.com/personal/user1_contoso_com", "https://contoso-my.sharepoint.com/personal/user2_contoso_com", "https://contoso-my.sharepoint.com/personal/person3_contoso_com") <# As an alternative to specifying the URLs as an array, you can import them from a CSV file (no header, single value per row). Then, use: $webUrls = Get-Content -Path "File_path_and_name.csv" #> $listTitle = "Documents" function Load-SharePointOnlineClientComponentAssemblies { [cmdletbinding()] param() process { # assembly location: C:\Program Files\Common Files\microsoft shared\Web Server Extensions\16\ISAPI try { Write-Verbose "Loading Assembly: Microsoft.Office.Client.Policy, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.Office.Client.Policy, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.Office.Client.TranslationServices, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.Office.Client.TranslationServices, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.DocumentManagement, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.DocumentManagement, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.Publishing, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.Publishing, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.Runtime, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.Runtime, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.Search.Applications, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.Search.Applications, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.Search, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.Search, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.Taxonomy, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.Taxonomy, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null Write-Verbose "Loading Assembly: Microsoft.SharePoint.Client.UserProfiles, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c" [System.Reflection.Assembly]::Load("Microsoft.SharePoint.Client.UserProfiles, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c") | Out-Null return $true } catch { if($_.Exception.Message -match "Could not load file or assembly") { Write-Error -Message "Unable to load the SharePoint Server 2013 Client Components.`nDownload Location: http://www.microsoft.com/en-us/download/details.aspx?id=42038" } else { Write-Error -Exception $_.Exception } return $false } } } function Load-SharePointOnlineModule { [cmdletbinding()] param() process { do { # Installation location: C:\Program Files\SharePoint Online Management Shell\Microsoft.Online.SharePoint.PowerShell $spoModule = Get-Module -Name Microsoft.Online.SharePoint.PowerShell -ErrorAction SilentlyContinue if(-not $spoModule) { try { Import-Module Microsoft.Online.SharePoint.PowerShell -DisableNameChecking return $true } catch { if($_.Exception.Message -match "Could not load file or assembly") { Write-Error -Message "Unable to load the SharePoint Online Management Shell.`nDownload Location: http://www.microsoft.com/en-us/download/details.aspx?id=35588" } else { Write-Error -Exception $_.Exception } return $false } } else { return $true } } while(-not $spoModule) } } function Remove-IrmConfiguration { [cmdletbinding()] param( [parameter(Mandatory=$true)][Microsoft.SharePoint.Client.List]$List ) process { Write-Verbose "Disabling IRM Configuration on '$($List.Title)'" $List.IrmEnabled = $false $List.IrmExpire  = $false $List.IrmReject  = $false $List.InformationRightsManagementSettings.Reset() } end { if($List) { Write-Verbose "Committing IRM configuration settings on '$($list.Title)'" $list.InformationRightsManagementSettings.Update() $list.Update() $script:clientContext.Load($list) $script:clientContext.ExecuteQuery() } } } function Get-CredentialFromCredentialCache { [cmdletbinding()] param([string]$CredentialName) #if( Test-Path variable:\global:CredentialCache ) if( Get-Variable O365TenantAdminCredentialCache -Scope Global -ErrorAction SilentlyContinue ) { if($global:O365TenantAdminCredentialCache.ContainsKey($CredentialName)) { Write-Verbose "Credential Cache Hit: $CredentialName" return $global:O365TenantAdminCredentialCache[$CredentialName] } } Write-Verbose "Credential Cache Miss: $CredentialName" return $null } function Add-CredentialToCredentialCache { [cmdletbinding()] param([System.Management.Automation.PSCredential]$Credential) if(-not (Get-Variable CredentialCache -Scope Global -ErrorAction SilentlyContinue)) { Write-Verbose "Initializing the Credential Cache" $global:O365TenantAdminCredentialCache = @{} } Write-Verbose "Adding Credential to the Credential Cache" $global:O365TenantAdminCredentialCache[$Credential.UserName] = $Credential } # load the required assemblies and Windows PowerShell modules if(-not ((Load-SharePointOnlineClientComponentAssemblies) -and (Load-SharePointOnlineModule)) ) { return } # Add the credentials to the client context and SharePoint Online service connection # check for cached credentials to use $o365TenantAdminCredential = Get-CredentialFromCredentialCache -CredentialName $tenantAdmin if(-not $o365TenantAdminCredential) { # when credentials are not cached, prompt for the tenant admin credentials $o365TenantAdminCredential = Get-Credential -UserName $tenantAdmin -Message "Enter the password for the Office 365 admin" if(-not $o365TenantAdminCredential -or -not $o365TenantAdminCredential.UserName -or $o365TenantAdminCredential.Password.Length -eq 0 ) { Write-Error -Message "Could not validate the supplied tenant admin credentials" return } # add the credentials to the cache Add-CredentialToCredentialCache -Credential $o365TenantAdminCredential } # connect to Office365 first, required for SharePoint Online cmdlets to run Connect-SPOService -Url $sharepointAdminCenterUrl -Credential $o365TenantAdminCredential # enumerate each of the specified site URLs foreach($webUrl in $webUrls) { $grantedSiteCollectionAdmin = $false try { # establish the client context and set the credentials to connect to the site $script:clientContext = New-Object Microsoft.SharePoint.Client.ClientContext($webUrl) $script:clientContext.Credentials = New-Object Microsoft.SharePoint.Client.SharePointOnlineCredentials($o365TenantAdminCredential.UserName, $o365TenantAdminCredential.Password) # initialize the site and web context $script:clientContext.Load($script:clientContext.Site) $script:clientContext.Load($script:clientContext.Web) $script:clientContext.ExecuteQuery() # load and ensure the tenant admin user account if present on the target SharePoint site $tenantAdminUser = $script:clientContext.Web.EnsureUser($o365TenantAdminCredential.UserName) $script:clientContext.Load($tenantAdminUser) $script:clientContext.ExecuteQuery() # check if the tenant admin is a site admin if( -not $tenantAdminUser.IsSiteAdmin ) { try { # grant the tenant admin temporary admin rights to the site collection Set-SPOUser -Site $script:clientContext.Site.Url -LoginName $o365TenantAdminCredential.UserName -IsSiteCollectionAdmin $true | Out-Null $grantedSiteCollectionAdmin = $true } catch { Write-Error $_.Exception return } } try { # load the list orlibrary using CSOM $list = $null $list = $script:clientContext.Web.Lists.GetByTitle($listTitle) $script:clientContext.Load($list) $script:clientContext.ExecuteQuery() Remove-IrmConfiguration -List $list } catch { Write-Error -Message "Error setting IRM configuration on site: $webUrl.`nError Details: $($_.Exception.ToString())" } } finally { if($grantedSiteCollectionAdmin) { # remove the temporary admin rights to the site collection Set-SPOUser -Site $script:clientContext.Site.Url -LoginName $o365TenantAdminCredential.UserName -IsSiteCollectionAdmin $false | Out-Null } } } Disconnect-SPOService -ErrorAction SilentlyContinue
```

## <a name="BKMK_Office2013Configuration"></a>2016 roku pakietu Office i pakietu Office 2013: Konfiguracja dla klientów
Ponieważ te nowszych wersjach pakietu Office obsługują Azure RMS, Konfiguracja komputera klienta, nie jest wymagana do obsługi funkcji zarządzania prawami prawa informacje dla aplikacji, takich jak Word, Excel, PowerPoint, Outlook i aplikacji sieci Web programu Outlook. Wszyscy użytkownicy mają przeprowadzić jest logowanie do aplikacji pakietu Office z ich [!INCLUDE[o365_1](../Token/o365_1_md.md)] poświadczenia i ich można chronić pliki i wiadomości e-mail i korzystać z plików i wiadomości e-mail, które chronionych przez innych użytkowników.

Jednak firma Microsoft zaleca stanowią uzupełnienie te aplikacje za pomocą funkcji zarządzania prawami udostępnianie aplikacji, umożliwiający użytkownikom korzystania z urzędem dodatków. Aby uzyskać więcej informacji, zobacz [Rights Management aplikacji do udostępniania: Instalacja i konfiguracja dla klientów](../Topic/Configuring_Applications_for_Azure_Rights_Management.md#BKMK_SharingApp) w tym temacie.

## <a name="BKMK_Office2010Configuration"></a>Pakiet Office 2010: Konfiguracja dla klientów
Dla komputerów klienckich do Azure RMS za pomocą pakietu Office 2010 którego mają zainstalowanego Rights Management udostępniania aplikacji dla systemu Windows. Nie dalszych jest wymagana konfiguracja innych niż użytkownicy muszą się zarejestrować przy użyciu ich [!INCLUDE[o365_1](../Token/o365_1_md.md)] poświadczenia i ich można chronić pliki i korzystać z plików, które chronionych przez innych użytkowników.

Aby uzyskać więcej informacji na temat Rights Management aplikacji do udostępniania, zobacz [Rights Management aplikacji do udostępniania: Instalacja i konfiguracja dla klientów](../Topic/Configuring_Applications_for_Azure_Rights_Management.md#BKMK_SharingApp) w tym temacie.

## <a name="BKMK_SharingApp"></a>Rights Management aplikacji do udostępniania: Instalacja i konfiguracja dla klientów
Zarządzania prawami (RMS) udostępnianie aplikacji jest wymagana dla komputerów klienckich do Azure RMS za pomocą pakietu Office 2010 i zalecane w przypadku wszystkich komputerów i urządzeń przenośnych, które obsługują Azure RMS. RMS sharing aplikacji integruje się z Office aplikacji przez zainstalowanie pakietu Office dodatku, aby użytkownicy mogą łatwo ochrony plików i wiadomości e-mail, bezpośrednio ze Wstążki. Oferuje także ogólnego ochrony dla typów plików, które nie jest obsługiwana przez Azure RMS i dokumentu śledzenia witryny dla użytkowników, śledzenie i odwołania plików, które mają one chronione.

### <a name="BKMK_SharingAppforWindows"></a>RMS sharing aplikacji dla systemu Windows: Instalacja i Konfiguracja
Aby zainstalować i skonfigurować RMS sharing aplikacji dla systemu Windows do użycia we wdrożeniach enterprise, zobacz [Podręcznik administratora aplikacji udostępniania Rights Management](http://technet.microsoft.com/library/dn339003.aspx).

> [!TIP]
> Jeśli chcesz szybko zainstalować i przetestować RMS sharing aplikacji dla pojedynczego komputera, zobacz [pobierze i zainstaluje Rights Management aplikacji do udostępniania](http://technet.microsoft.com/library/dn574734.aspx) z [Podręcznik użytkownika aplikacji udostępniania Rights Management](http://technet.microsoft.com/library/dn339006.aspx).

### <a name="BKMK_SharingAppMovileDevices"></a>RMS sharing aplikacji mobilnej platformy: Instalacja
Aby zainstalować RMS aplikacji mobilnej platformy, można pobrać odpowiednich aplikacji za pomocą łącza na [strony Microsoft Rights Management](http://go.microsoft.com/fwlink/?LinkId=303970). Brak konfiguracji niezbędnym do Azure RMS za pomocą tej aplikacji.

## <a name="BKMK_RMSAPIs"></a>Inne aplikacje, które obsługują interfejsy API usług RMS: Instalacja i Konfiguracja
Ta kategoria zawiera-biznesowych aplikacji, które są zapisywane we własnym zakresie przy użyciu zestawu SDK usług RMS i aplikacji w dostawcy oprogramowania, opracowane przy użyciu zestawu SDK usług RMS. Dla tych aplikacji postępuj zgodnie z instrukcjami są dostarczane z daną aplikacją.

## Następne kroki
Po skonfigurowaniu aplikacji do obsługi Azure Rights Management, użyj [Mapa wdrożenia usługi zarządzania prawami systemu Azure](../Topic/Azure_Rights_Management_Deployment_Roadmap.md) do sprawdzenia, czy istnieją inne kroki konfiguracji, które należy wykonać przed można wdrożyć [!INCLUDE[aad_rightsmanagement_1](../Token/aad_rightsmanagement_1_md.md)] dla użytkowników i administratorów. Jeśli nie, zobacz [Za pomocą systemu Azure Rights Management](../Topic/Using_Azure_Rights_Management.md) innej.

## Zobacz też
[Konfigurowanie Azure Rights Management](../Topic/Configuring_Azure_Rights_Management.md)

